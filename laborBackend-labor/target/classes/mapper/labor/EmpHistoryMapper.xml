<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yuantu.labor.mapper.EmpHistoryMapper">

    <resultMap type="EmpHistory" id="EmpHistoryResult">
        <result property="historyId" column="history_id"/>
        <result property="historyYearMoth" column="history_year_moth"/>
        <result property="empId" column="emp_id"/>
        <result property="empCode" column="emp_code"/>
        <result property="empAvatarUrl" column="emp_avatar_url"/>
        <result property="empIdcard" column="emp_idcard"/>
        <result property="empName" column="emp_name"/>
        <result property="empAge" column="emp_age"/>
        <result property="empStatus" column="emp_status"/>
        <result property="empPoliticalStatus" column="emp_political_status"/>
        <result property="empGender" column="emp_gender"/>
        <result property="empEducation" column="emp_education"/>
        <result property="empSpeciality" column="emp_speciality"/>
        <result property="empTitle" column="emp_title"/>
        <result property="empCategory" column="emp_category"/>
        <result property="empType" column="emp_type"/>
        <result property="empDeptId" column="emp_dept_id"/>
        <result property="empDeptName" column="emp_dept_name"/>
        <result property="empEmployingUnits" column="emp_employing_units"/>
        <result property="empHrCompany" column="emp_hr_company"/>
        <result property="empPositionLevel" column="emp_position_level"/>
        <result property="empPosition" column="emp_position"/>
        <result property="empHiredate" column="emp_hiredate"/>
        <result property="empSalaryLevel" column="emp_salary_level"/>
        <result property="empRemark" column="emp_remark"/>
        <result property="empEmergencyContact" column="emp_emergency_contact"/>
        <result property="empEmergencyContactPhone" column="emp_emergency_contact_phone"/>
        <result property="empTelephone" column="emp_telephone"/>
        <result property="empHomeAddress" column="emp_home_address"/>
        <result property="empReference" column="emp_reference"/>
        <result property="empUpdateTime" column="emp_update_time"/>
        <result property="empExpireTime" column="emp_expire_time"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <sql id="selectEmpHistoryVo">
        select history_id,
               history_year_moth,
               emp_id,
               emp_code,
               emp_avatar_url,
               CAST(SP_DECRYPT(emp_idcard) AS CHAR(128)) as emp_idcard,
               emp_name,
               emp_age,
               birth_date,
               emp_status,
               emp_political_status,
               emp_gender,
               emp_education,
               emp_speciality,
               emp_title,
               emp_category,
               emp_type,
               emp_dept_id,
               emp_dept_name,
               emp_employing_units,
               emp_hr_company,
               emp_position_level,
               emp_position,
               emp_hiredate,
               emp_salary_level,
               emp_remark,
               emp_emergency_contact,
               emp_emergency_contact_phone,
               emp_telephone,
               emp_home_address,
               emp_reference,
               emp_update_time,
               emp_expire_time,
               create_by,
               create_time,
               update_by,
               update_time,
               disabled,
               nation,
               retire_reminder,
               hire_limit_date,
               dept_info_two,
               dept_info_three,
               emp_position_category,
               native_place,
               birth_place,
               domicile_place,
               school,
               highest_education,
               graduate_time,
               acquire_time,
               attend_time,
               refuse_month,
               accumulative_month,
               contract_start_time,
               contract_end_time,
               work_phone,
               on_job_time,
               salary_level_min,
               salary_level_max
        from emp_history
    </sql>

    <select id="selectEmpHistoryList" parameterType="com.yuantu.labor.vo.EmpHistoryQueryParamsVO"
            resultMap="EmpHistoryResult">
        <include refid="selectEmpHistoryVo"/>
        <where>
            and disabled = 0
            <if test="historyYearMoth != null  and historyYearMoth != ''">and history_year_moth = #{historyYearMoth}
            </if>
            <if test="empId != null ">and emp_id = #{empId}</if>
            <if test="empCode != null  and empCode != ''">and emp_code = #{empCode}</if>
            <if test="empAvatarUrl != null  and empAvatarUrl != ''">and emp_avatar_url = #{empAvatarUrl}</if>
            <if test="nameOrIdcard != null  and nameOrIdcard != ''">and ph_emp_name like concat('%', #{nameOrIdcard},
                '%')
            </if>
            <if test="nameOrIdcard != null  and nameOrIdcard != ''">or ph_emp_idcard like concat('%', #{nameOrIdcard},
                '%')
            </if>
            <if test="empAge != null ">and emp_age = #{empAge}</if>
            <if test="empStatus != null  and empStatus != ''">and emp_status = #{empStatus}</if>
            <if test="empPoliticalStatus != null  and empPoliticalStatus != ''">and emp_political_status =
                #{empPoliticalStatus}
            </if>
            <if test="empGender != null  and empGender != ''">and emp_gender = #{empGender}</if>
            <if test="empEducation != null  and empEducation != ''">and emp_education = #{empEducation}</if>
            <if test="empSpeciality != null  and empSpeciality != ''">and emp_speciality = #{empSpeciality}</if>
            <if test="empTitle != null  and empTitle != ''">and emp_title = #{empTitle}</if>
            <if test="empCategory != null  and empCategory != ''">and emp_category = #{empCategory}</if>
            <if test="empType != null  and empType != ''">and emp_type = #{empType}</if>
            <if test="empDeptId != null ">and emp_dept_id = #{empDeptId}</if>
            <if test="empDeptName != null  and empDeptName != ''">and emp_dept_name like concat('%', #{empDeptName},
                '%')
            </if>
            <if test="empEmployingUnits != null  and empEmployingUnits != ''">and emp_employing_units =
                #{empEmployingUnits}
            </if>
            <if test="empHrCompany != null  and empHrCompany != ''">and emp_hr_company = #{empHrCompany}</if>
            <if test="empPositionLevel != null  and empPositionLevel != ''">and emp_position_level =
                #{empPositionLevel}
            </if>
            <if test="empPosition != null  and empPosition != ''">and emp_position = #{empPosition}</if>
            <if test="empHiredate != null ">and emp_hiredate = #{empHiredate}</if>
            <if test="empSalaryLevel != null  and empSalaryLevel != ''">and emp_salary_level = #{empSalaryLevel}</if>
            <if test="empRemark != null  and empRemark != ''">and emp_remark = #{empRemark}</if>
            <if test="empEmergencyContact != null  and empEmergencyContact != ''">and emp_emergency_contact =
                #{empEmergencyContact}
            </if>
            <if test="empEmergencyContactPhone != null  and empEmergencyContactPhone != ''">and
                emp_emergency_contact_phone
                = #{empEmergencyContactPhone}
            </if>
            <if test="empTelephone != null  and empTelephone != ''">and emp_telephone = #{empTelephone}</if>
            <if test="empHomeAddress != null  and empHomeAddress != ''">and emp_home_address = #{empHomeAddress}</if>
            <if test="empReference != null  and empReference != ''">and emp_reference = #{empReference}</if>
            <if test="empUpdateTime != null ">and emp_update_time = #{empUpdateTime}</if>
            <if test="empExpireTime != null ">and emp_expire_time = #{empExpireTime}</if>
            <if test="createBy != null  and createBy != ''">and create_by = #{createBy}</if>
            <if test="createTime != null ">and create_time = #{createTime}</if>
            <if test="updateBy != null  and updateBy != ''">and update_by = #{updateBy}</if>
            <if test="updateTime != null ">and update_time = #{updateTime}</if>
        </where>
    </select>


    <select id="selectEmpHistoryListByYearMonth" parameterType="String"
            resultType="com.yuantu.labor.vo.EmpHistoryInfoVO">
        select history_id,
        history_year_moth,
        emp_id,
        emp_code,
        emp_avatar_url,
        INSERT(SP_DECRYPT(emp_idcard),5,10,'**********') as emp_idcard,
        emp_name,
        emp_age,
        birth_date,
        emp_status,
        emp_political_status,
        emp_gender,
        emp_education,
        emp_speciality,
        emp_title,
        emp_category,
        emp_type,
        emp_dept_id,
        emp_dept_name,
        emp_employing_units,
        emp_hr_company,
        emp_position_level,
        emp_position,
        emp_hiredate,
        emp_salary_level,
        emp_remark,
        emp_emergency_contact,
        emp_emergency_contact_phone,
        emp_telephone,
        emp_home_address,
        emp_reference,
        emp_update_time,
        emp_expire_time,
        create_by,
        create_time,
        update_by,
        update_time
        ,disabled
        from emp_history
        <where>
            and disabled = 0
            <if test="historyYearMonth != null  and historyYearMonth != ''">and history_year_moth = #{historyYearMonth}
            </if>
        </where>
    </select>

    <select id="selectEmpHistoryByHistoryId" parameterType="Long" resultMap="EmpHistoryResult">
        <include refid="selectEmpHistoryVo"/>
        where history_id = #{historyId} and disabled = 0
    </select>
    <select id="selectEmployeeInfoHistoryList" resultType="com.yuantu.labor.domain.EmpHistory">
        <include refid="selectEmpHistoryVo"/>
        where
        emp_history.disabled = 0
        <if test="month != null">
            and DATE_FORMAT(create_time, '%Y-%m') = DATE_FORMAT(#{month} , '%Y-%m')
        </if>
        <if test="empIds != null and empIds.size() > 0">
            and emp_id in
            <foreach collection="empIds" item="empId" open="(" separator="," close=")">
                #{empId}
            </foreach>
        </if>
        <if test="keyword != null and keyword != ''">
            and (emp_name like concat ('%', #{keyword}, '%') or emp_idcard like concat ('%', #{keyword}, '%'))
        </if>
        <if test="empIdcard != null and empIdcard != '' ">
            and emp_idcard = #{empIdcard}
        </if>
        <if test="empName != null and empName != '' ">
            and emp_name like concat('%', #{empName}, '%')
        </if>
        <if test="minAge != null">
            and emp_age &gt;= #{minAge}
        </if>
        <if test="maxAge != null">
            and emp_age &lt;= #{maxAge}
        </if>
        <if test="empEmployingUnits != null and empEmployingUnits != '' ">
            and emp_employing_units like concat('%', #{empEmployingUnits}, '%')
        </if>
        <if test="empDeptId != null">
            and emp_dept_id = #{empDeptId}
        </if>
        <if test="empDeptName != null and empDeptName != '' ">
            and emp_dept_name like concat('%', #{empDeptName}, '%')
        </if>
        <if test="empHrCompany != null and empHrCompany != '' ">
            and emp_hr_company like concat('%', #{empHrCompany}, '%')
        </if>
        <if test="empPosition != null and empPosition != '' ">
            and emp_position like concat('%', #{empPosition}, '%')
        </if>
        <if test="empSpeciality != null and empSpeciality != '' ">
            and emp_speciality like concat('%', #{empSpeciality}, '%')
        </if>
        <if test="minEmpHireDate != null">
            and DATE_FORMAT(emp_hiredate, '%Y-%m-%d') &gt;= DATE_FORMAT(#{minEmpHireDate}, '%Y-%m-%d')
        </if>
        <if test="maxEmpHireDate != null">
            and DATE_FORMAT(emp_hiredate, '%Y-%m-%d') &lt;= DATE_FORMAT(#{maxEmpHireDate}, '%Y-%m-%d')
        </if>
        <if test="minEmpExpireTime != null">
            and DATE_FORMAT(emp_expire_time, '%Y-%m-%d') &gt;= DATE_FORMAT(#{minEmpExpireTime},'%Y-%m-%d')
        </if>
        <if test="maxEmpExpireTime != null">
            and DATE_FORMAT(emp_expire_time, '%Y-%m-%d') &lt;= DATE_FORMAT(#{maxEmpExpireTime},'%Y-%m-%d')
        </if>
        <if test="empStatus != null and empStatus != '' ">
            and emp_status = #{empStatus}
        </if>
        <if test="empGender != null and empGender != '' ">
            and emp_gender = #{empGender}
        </if>
        <if test="empPositionLevel != null and empPositionLevel != '' ">
            and emp_position_level = #{empPositionLevell}
        </if>
        <if test="empSalaryLevel != null and empSalaryLevel != '' ">
            and emp_salary_level = #{empSalaryLevel}
        </if>
        <if test="empPoliticalStatus != null and empPoliticalStatus != '' ">
            and emp_political_status = #{empPoliticalStatus}
        </if>
        <if test="empEducation != null and empEducation != '' ">
            and emp_education = #{empEducation}
        </if>
        <if test="empTitle != null and empTitle != '' ">
            and emp_title = #{empTitle}
        </if>
        <if test="empType != null and empType != '' ">
            and emp_type = #{empType}
        </if>
        <if test="empCategory != null and empCategory != '' ">
            and emp_category = #{empCategory}
        </if>
    </select>

    <select id="selectEmployeeInfoHistory" resultType="com.yuantu.labor.domain.EmpHistory">
        <include refid="selectEmpHistoryVo"/>
        where
        emp_history.disabled = 0
        <if test="month != null">
            and history_year_moth = DATE_FORMAT(#{month} , '%Y-%m')
        </if>
        <if test="empIds != null and empIds.size() > 0">
            and history_id in
            <foreach collection="empIds" item="empId" open="(" separator="," close=")">
                #{empId}
            </foreach>
        </if>
        <if test="keyword != null and keyword != ''">
            and (emp_name like concat ('%', #{keyword}, '%') or emp_idcard like concat ('%', #{keyword}, '%'))
        </if>
        <if test="empIdcard != null and empIdcard != '' ">
            and emp_idcard = #{empIdcard}
        </if>
        <if test="empName != null and empName != '' ">
            and emp_name like concat('%', #{empName}, '%')
        </if>
        <if test="minAge != null">
            and emp_age &gt;= #{minAge}
        </if>
        <if test="maxAge != null">
            and emp_age &lt;= #{maxAge}
        </if>
        <if test="empEmployingUnits != null and empEmployingUnits != '' ">
            and emp_employing_units = #{empEmployingUnits}
        </if>
        <if test="empDeptId != null">
            and emp_dept_id = #{empDeptId}
        </if>
        <if test="empDeptName != null and empDeptName != '' ">
            and emp_dept_name like concat('%', #{empDeptName}, '%')
        </if>
        <if test="empHrCompany != null and empHrCompany != '' ">
            and emp_hr_company = #{empHrCompany}
        </if>
        <if test="empPosition != null and empPosition != '' ">
            and emp_position = #{empPosition}
        </if>
        <if test="empSpeciality != null and empSpeciality != '' ">
            and emp_speciality like concat('%', #{empSpeciality}, '%')
        </if>
        <if test="minEmpHireDate != null">
            and DATE_FORMAT(emp_hiredate, '%Y-%m-%d') &gt;= DATE_FORMAT(#{minEmpHireDate}, '%Y-%m-%d')
        </if>
        <if test="maxEmpHireDate != null">
            and DATE_FORMAT(emp_hiredate, '%Y-%m-%d') &lt;= DATE_FORMAT(#{maxEmpHireDate}, '%Y-%m-%d')
        </if>
        <if test="minEmpExpireTime != null">
            and DATE_FORMAT(emp_expire_time, '%Y-%m-%d') &gt;= DATE_FORMAT(#{minEmpExpireTime},'%Y-%m-%d')
        </if>
        <if test="maxEmpExpireTime != null">
            and DATE_FORMAT(emp_expire_time, '%Y-%m-%d') &lt;= DATE_FORMAT(#{maxEmpExpireTime},'%Y-%m-%d')
        </if>
        <if test="empStatus != null and empStatus != '' ">
            and emp_status = #{empStatus}
        </if>
        <if test="empGender != null and empGender != '' ">
            and emp_gender = #{empGender}
        </if>
        <if test="empPositionLevel != null and empPositionLevel != '' ">
            and emp_position_level = #{empPositionLevel}
        </if>
        <if test="empSalaryLevel != null and empSalaryLevel != '' ">
            and emp_salary_level = #{empSalaryLevel}
        </if>
        <if test="empPoliticalStatus != null and empPoliticalStatus != '' ">
            and emp_political_status = #{empPoliticalStatus}
        </if>
        <if test="empEducation != null and empEducation != '' ">
            and emp_education = #{empEducation}
        </if>
        <if test="empTitle != null and empTitle != '' ">
            and emp_title = #{empTitle}
        </if>
        <if test="empType != null and empType != '' ">
            and emp_type = #{empType}
        </if>
        <if test="empCategory != null and empCategory != '' ">
            and emp_category = #{empCategory}
        </if>
        <if test="empRemark != null and empRemark != '' ">
            and emp_remark = #{empRemark}
        </if>
        <if test="birthdayStart != null">
            and DATE_FORMAT(birth_date, '%Y-%m-%d') &gt;= DATE_FORMAT(#{birthdayStart}, '%Y-%m-%d')
        </if>
        <if test="birthdayEnd != null">
            and DATE_FORMAT(birth_date, '%Y-%m-%d') &lt;= DATE_FORMAT(#{birthdayEnd}, '%Y-%m-%d')
        </if>
        <if test="hireLimitDateStart != null">
            and DATE_FORMAT(hire_limit_date, '%Y-%m-%d') &gt;= DATE_FORMAT(#{hireLimitDateStart}, '%Y-%m-%d')
        </if>
        <if test="hireLimitDateEnd != null">
            and DATE_FORMAT(hire_limit_date, '%Y-%m-%d') &lt;= DATE_FORMAT(#{hireLimitDateEnd}, '%Y-%m-%d')
        </if>
        <if test="empCode != null and empCode != '' ">
            and emp_code like concat('%', #{empCode}, '%')
        </if>
        <if test="deptInfoTwo != null and deptInfoTwo != '' ">
            and dept_info_two like concat('%', #{deptInfoTwo}, '%')
        </if>
        <if test="deptInfoThree != null and deptInfoThree != '' ">
            and dept_info_three like concat('%', #{deptInfoThree}, '%')
        </if>
        <if test="onJobTimeStart != null">
            and DATE_FORMAT(on_job_time, '%Y-%m-%d') &gt;= DATE_FORMAT(#{onJobTimeStart}, '%Y-%m-%d')
        </if>
        <if test="onJobTimeEnd != null">
            and DATE_FORMAT(on_job_time, '%Y-%m-%d') &lt;= DATE_FORMAT(#{onJobTimeEnd}, '%Y-%m-%d')
        </if>
        <if test="nativePlaceStr != null and nativePlaceStr != '' ">
            and FIND_IN_SET(#{nativePlaceStr}, native_place) > 0
        </if>
        <if test="birthPlaceStr != null and birthPlaceStr != '' ">
            and FIND_IN_SET(#{birthPlaceStr}, birth_place) > 0
        </if>
        <if test="school != null and school != '' ">
            and school like concat('%', #{school}, '%')
        </if>
        <if test="graduateTimeStart != null">
            and DATE_FORMAT(graduate_time, '%Y-%m-%d') &gt;= DATE_FORMAT(#{graduateTimeStart}, '%Y-%m-%d')
        </if>
        <if test="graduateTimeEnd != null">
            and DATE_FORMAT(graduate_time, '%Y-%m-%d') &lt;= DATE_FORMAT(#{graduateTimeEnd}, '%Y-%m-%d')
        </if>
        <if test="attendTimeStart != null">
            and DATE_FORMAT(attend_time, '%Y-%m-%d') &gt;= DATE_FORMAT(#{attendTimeStart}, '%Y-%m-%d')
        </if>
        <if test="attendTimeEnd != null">
            and DATE_FORMAT(attend_time, '%Y-%m-%d') &lt;= DATE_FORMAT(#{attendTimeEnd}, '%Y-%m-%d')
        </if>
        <if test="refuseMonthMin != null">
            and refuse_month &gt;= #{refuseMonthMin}
        </if>
        <if test="refuseMonthMax != null">
            and refuse_month &lt;= #{refuseMonthMax}
        </if>
        <if test="accumulativeMonthMin != null">
            and accumulative_month &gt;= #{accumulativeMonthMin}
        </if>
        <if test="accumulativeMonthMax != null">
            and accumulative_month &lt;= #{accumulativeMonthMax}
        </if>
        <if test="contractTimeStart != null">
            and DATE_FORMAT(contract_start_time, '%Y-%m-%d') &gt;= DATE_FORMAT(#{contractTimeStart}, '%Y-%m-%d')
        </if>
        <if test="contractTimeEnd != null">
            and DATE_FORMAT(contract_end_time, '%Y-%m-%d') &lt;= DATE_FORMAT(#{contractTimeEnd}, '%Y-%m-%d')
        </if>
        <if test="empTelephone != null and empTelephone != '' ">
            and emp_telephone like concat('%', #{empTelephone}, '%')
        </if>
        <if test="workPhone != null and workPhone != '' ">
            and work_phone like concat('%', #{workPhone}, '%')
        </if>
        <if test="empReference != null and empReference != '' ">
            and emp_reference like concat('%', #{empReference}, '%')
        </if>
        <if test="highestEducation != null and highestEducation != '' ">
            and highest_education = #{highestEducation}
        </if>
    </select>

    <select id="selectEmployeeInfoHistoryExportInfos" resultType="com.yuantu.labor.domain.EmpHistory">
        <include refid="selectEmpHistoryVo"/>
        where history_year_moth = DATE_FORMAT(#{empExport.date} , '%Y-%m') and disabled = 0
        <if test="empExport.empIds != null and empExport.empIds.size() > 0">
            and emp_id in
            <foreach collection="empExport.empIds" item="empId" open="(" separator="," close=")">
                #{empId}
            </foreach>
        </if>
    </select>
    <select id="findEmpInfosByCreateTime" resultType="com.yuantu.labor.domain.EmpHistory">
        <include refid="selectEmpHistoryVo"/>
        where DATE_FORMAT(create_time, '%Y-%m') = DATE_FORMAT(#{currentTime} , '%Y-%m') and disabled = 0
    </select>
    <select id="findEmpInfosByTimeRangeForCreateTime" resultType="com.yuantu.labor.domain.EmpHistory">
        <include refid="selectEmpHistoryVo"/>
        where DATE_FORMAT(create_time, '%Y-%m') &gt;= DATE_FORMAT(#{startTime} , '%Y-%m')
        and DATE_FORMAT(create_time, '%Y-%m') &lt;= DATE_FORMAT(#{endTime} , '%Y-%m') and disabled = 0
    </select>
    <select id="findEmpInfoWithMinCrateTime" resultType="com.yuantu.labor.domain.EmpHistory">
        <include refid="selectEmpHistoryVo"/>
        where disabled = 0 order by create_time asc limit 1
    </select>
    <select id="findAllEmployeeHistory" resultType="com.yuantu.labor.domain.EmpHistory">
        <include refid="selectEmpHistoryVo"/>
        where disabled = 0
    </select>
    <select id="findEmpInfosByDeptIdAndCreateYear" resultType="com.yuantu.labor.domain.EmpHistory">
        <include refid="selectEmpHistoryVo"/>
        where disabled = 0
        and emp_dept_id = #{deptId}
        and emp_status in (1,2,5,7)
        and year(create_time) = #{valueYear}
    </select>

    <insert id="insertEmpHistory" parameterType="EmpHistory" useGeneratedKeys="true" keyProperty="historyId">
        insert into emp_history
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="historyYearMoth != null">history_year_moth,</if>
            <if test="empId != null">emp_id,</if>
            <if test="empCode != null">emp_code,</if>
            <if test="empAvatarUrl != null">emp_avatar_url,</if>
            <if test="empIdcard != null">emp_idcard,</if>
            <if test="empName != null and empName != ''">emp_name,</if>
            <if test="empAge != null">emp_age,</if>
            <if test="empStatus != null and empStatus != ''">emp_status,</if>
            <if test="empPoliticalStatus != null">emp_political_status,</if>
            <if test="empGender != null">emp_gender,</if>
            <if test="empEducation != null">emp_education,</if>
            <if test="empSpeciality != null">emp_speciality,</if>
            <if test="empTitle != null">emp_title,</if>
            <if test="empCategory != null">emp_category,</if>
            <if test="empType != null">emp_type,</if>
            <if test="empDeptId != null">emp_dept_id,</if>
            <if test="empDeptName != null">emp_dept_name,</if>
            <if test="empEmployingUnits != null">emp_employing_units,</if>
            <if test="empHrCompany != null">emp_hr_company,</if>
            <if test="empPositionLevel != null">emp_position_level,</if>
            <if test="empPosition != null">emp_position,</if>
            <if test="empHiredate != null">emp_hiredate,</if>
            <if test="empSalaryLevel != null">emp_salary_level,</if>
            <if test="empRemark != null">emp_remark,</if>
            <if test="empEmergencyContact != null">emp_emergency_contact,</if>
            <if test="empEmergencyContactPhone != null">emp_emergency_contact_phone,</if>
            <if test="empTelephone != null">emp_telephone,</if>
            <if test="empHomeAddress != null">emp_home_address,</if>
            <if test="empReference != null">emp_reference,</if>
            <if test="empUpdateTime != null">emp_update_time,</if>
            <if test="empExpireTime != null">emp_expire_time,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="nation != null and nation != ''">nation,</if>
            <if test="retireReminder != null and retireReminder != ''">retire_reminder,</if>
            <if test="hireLimitDate != null">hire_limit_date,</if>
            <if test="deptInfoTwo != null  and deptInfoTwo != ''">dept_info_two,</if>
            <if test="deptInfoThree != null and deptInfoThree != ''">dept_info_three,</if>
            <if test="empPositionCategory != null and empPositionCategory != ''">emp_position_category,</if>
            <if test="nativePlace != null and nativePlace != ''">native_place,</if>
            <if test="birthPlace != null and birthPlace != ''">birth_place,</if>
            <if test="domicilePlace != null and domicilePlace != ''">domicile_place,</if>
            <if test="school != null and school != ''">school,</if>
            <if test="highestEducation != null and highestEducation != ''">highest_education,</if>
            <if test="graduateTime != null">graduate_time,</if>
            <if test="acquireTime != null">acquire_time,</if>
            <if test="attendTime != null">attend_time,</if>
            <if test="refuseMonth != null">refuse_month,</if>
            <if test="accumulativeMonth != null">accumulative_month,</if>
            <if test="contractStartTime != null">contract_start_time,</if>
            <if test="contractEndTime != null">contract_end_time,</if>
            <if test="workPhone != null and workPhone != ''">work_phone,</if>
            <if test="onJobTime != null">on_job_time,</if>
            <if test="birthDate != null">birth_date,</if>
            <if test="salaryLevelMin != null and salaryLevelMin != ''">salary_level_min,</if>
            <if test="salaryLevelMax != null and salaryLevelMax != ''">salary_level_max,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="historyYearMoth != null">#{historyYearMoth},</if>
            <if test="empId != null">#{empId},</if>
            <if test="empCode != null">#{empCode},</if>
            <if test="empAvatarUrl != null">#{empAvatarUrl},</if>
            <if test="empIdcard != null">SP_ENCRYPT(#{empIdcard}),</if>
            <if test="empName != null and empName != ''">#{empName},</if>
            <if test="empAge != null">#{empAge},</if>
            <if test="empStatus != null and empStatus != ''">#{empStatus},</if>
            <if test="empPoliticalStatus != null">#{empPoliticalStatus},</if>
            <if test="empGender != null">#{empGender},</if>
            <if test="empEducation != null">#{empEducation},</if>
            <if test="empSpeciality != null">#{empSpeciality},</if>
            <if test="empTitle != null">#{empTitle},</if>
            <if test="empCategory != null">#{empCategory},</if>
            <if test="empType != null">#{empType},</if>
            <if test="empDeptId != null">#{empDeptId},</if>
            <if test="empDeptName != null">#{empDeptName},</if>
            <if test="empEmployingUnits != null">#{empEmployingUnits},</if>
            <if test="empHrCompany != null">#{empHrCompany},</if>
            <if test="empPositionLevel != null">#{empPositionLevel},</if>
            <if test="empPosition != null">#{empPosition},</if>
            <if test="empHiredate != null">#{empHiredate},</if>
            <if test="empSalaryLevel != null">#{empSalaryLevel},</if>
            <if test="empRemark != null">#{empRemark},</if>
            <if test="empEmergencyContact != null">#{empEmergencyContact},</if>
            <if test="empEmergencyContactPhone != null">#{empEmergencyContactPhone},</if>
            <if test="empTelephone != null">#{empTelephone},</if>
            <if test="empHomeAddress != null">#{empHomeAddress},</if>
            <if test="empReference != null">#{empReference},</if>
            <if test="empUpdateTime != null">#{empUpdateTime},</if>
            <if test="empExpireTime != null">#{empExpireTime},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="nation != null and nation != ''">#{nation},</if>
            <if test="retireReminder != null and retireReminder != ''">#{retireReminder},</if>
            <if test="hireLimitDate != null">#{hireLimitDate},</if>
            <if test="deptInfoTwo != null  and deptInfoTwo != ''">#{deptInfoTwo},</if>
            <if test="deptInfoThree != null and deptInfoThree != ''">#{deptInfoThree},</if>
            <if test="empPositionCategory != null and empPositionCategory != ''">#{empPositionCategory},</if>
            <if test="nativePlace != null and nativePlace != ''">#{nativePlace},</if>
            <if test="birthPlace != null and birthPlace != ''">#{birthPlace},</if>
            <if test="domicilePlace != null and domicilePlace != ''">#{domicilePlace},</if>
            <if test="school != null and school != ''">#{school},</if>
            <if test="highestEducation != null and highestEducation != ''">#{highestEducation},</if>
            <if test="graduateTime != null">#{graduateTime},</if>
            <if test="acquireTime != null">#{acquireTime},</if>
            <if test="attendTime != null">#{attendTime},</if>
            <if test="refuseMonth != null">#{refuseMonth},</if>
            <if test="accumulativeMonth != null">#{accumulativeMonth},</if>
            <if test="contractStartTime != null">#{contractStartTime},</if>
            <if test="contractEndTime != null">#{contractEndTime},</if>
            <if test="workPhone != null and workPhone != ''">#{workPhone},</if>
            <if test="onJobTime != null">#{onJobTime},</if>
            <if test="birthDate != null">#{birthDate},</if>
            <if test="salaryLevelMin != null and salaryLevelMin != ''">#{salaryLevelMin},</if>
            <if test="salaryLevelMax != null and salaryLevelMax != ''">#{salaryLevelMax},</if>
        </trim>
    </insert>


    <insert id="batchInsertHistoryInfos" parameterType="java.util.List" useGeneratedKeys="true" keyProperty="historyId">
        insert into emp_history (history_year_moth, emp_id, emp_code,emp_idcard, emp_avatar_url, emp_name, emp_age,
        birth_date,
        emp_status, emp_political_status, emp_gender,
        emp_education, emp_speciality, emp_title, emp_category, emp_dept_id, emp_dept_name,
        emp_employing_units,emp_hr_company,
        emp_position_level, emp_position, emp_hiredate, emp_salary_level, emp_remark, emp_emergency_contact,
        emp_emergency_contact_phone,emp_telephone,
        emp_home_address, emp_reference, emp_update_time, emp_expire_time, create_by, create_time, update_by,
        update_time, disabled, nation, retire_reminder, hire_limit_date, dept_info_two, dept_info_three,
        emp_position_category, native_place, birth_place, domicile_place, school, highest_education, graduate_time,
        acquire_time, attend_time, refuse_month, accumulative_month, contract_start_time, contract_end_time, work_phone,
        on_job_time, salary_level_min, salary_level_max)
        values
        <foreach collection="list" item="item" separator=",">
            (#{item.historyYearMoth}, #{item.empId}, #{item.empCode}, #{item.empIdcard}, #{item.empAvatarUrl},
            #{item.empName}, #{item.empAge}, #{item.birthDate}, #{item.empStatus},
            #{item.empPoliticalStatus}, #{item.empGender}, #{item.empEducation}, #{item.empSpeciality},
            #{item.empTitle}, #{item.empCategory},
            #{item.empDeptId}, #{item.empDeptName}, #{item.empEmployingUnits}, #{item.empHrCompany},
            #{item.empPositionLevel}, #{item.empPosition}, #{item.empHiredate},
            #{item.empSalaryLevel}, #{item.empRemark}, #{item.empEmergencyContact}, #{item.empEmergencyContactPhone},
            #{item.empTelephone}, #{item.empHomeAddress},
            #{item.empReference}, #{item.empUpdateTime}, #{item.empExpireTime}, #{item.createBy}, #{item.createTime},
            #{item.updateBy}, #{item.updateTime}, #{item.disabled}, #{item.nation}, #{item.retireReminder},
            #{item.hireLimitDate},
            #{item.deptInfoTwo}, #{item.deptInfoThree}, #{item.empPositionCategory}, #{item.nativePlace},
            #{item.birthPlace},
            #{item.domicilePlace}, #{item.school}, #{item.highestEducation}, #{item.graduateTime}, #{item.acquireTime},
            #{item.attendTime}, #{item.refuseMonth}, #{item.accumulativeMonth}, #{item.contractStartTime},
            #{item.contractEndTime},
            #{item.workPhone}, #{item.onJobTime}, #{item.salaryLevelMin}, #{item.salaryLevelMax})
        </foreach>
    </insert>

    <update id="updateEmpHistory" parameterType="EmpHistory">
        update emp_history
        <trim prefix="SET" suffixOverrides=",">
            <if test="historyYearMoth != null">history_year_moth = #{historyYearMoth},</if>
            <if test="empId != null">emp_id = #{empId},</if>
            <if test="empCode != null">emp_code = #{empCode},</if>
            <if test="empAvatarUrl != null">emp_avatar_url = #{empAvatarUrl},</if>
            <if test="empIdcard != null">emp_idcard = SP_ENCRYPT(#{empIdcard}),</if>
            <if test="empName != null and empName != ''">emp_name = #{empName},</if>
            <if test="empAge != null">emp_age = #{empAge},</if>
            <if test="empStatus != null and empStatus != ''">emp_status = #{empStatus},</if>
            <if test="empPoliticalStatus != null">emp_political_status = #{empPoliticalStatus},</if>
            <if test="empGender != null">emp_gender = #{empGender},</if>
            <if test="empEducation != null">emp_education = #{empEducation},</if>
            <if test="empSpeciality != null">emp_speciality = #{empSpeciality},</if>
            <if test="empTitle != null">emp_title = #{empTitle},</if>
            <if test="empCategory != null">emp_category = #{empCategory},</if>
            <if test="empType != null">emp_type = #{empType},</if>
            <if test="empDeptId != null">emp_dept_id = #{empDeptId},</if>
            <if test="empDeptName != null">emp_dept_name = #{empDeptName},</if>
            <if test="empEmployingUnits != null">emp_employing_units = #{empEmployingUnits},</if>
            <if test="empHrCompany != null">emp_hr_company = #{empHrCompany},</if>
            <if test="empPositionLevel != null">emp_position_level = #{empPositionLevel},</if>
            <if test="empPosition != null">emp_position = #{empPosition},</if>
            <if test="empHiredate != null">emp_hiredate = #{empHiredate},</if>
            <if test="empSalaryLevel != null">emp_salary_level = #{empSalaryLevel},</if>
            <if test="empRemark != null">emp_remark = #{empRemark},</if>
            <if test="empEmergencyContact != null">emp_emergency_contact = #{empEmergencyContact},</if>
            <if test="empEmergencyContactPhone != null">emp_emergency_contact_phone = #{empEmergencyContactPhone},</if>
            <if test="empTelephone != null">emp_telephone = #{empTelephone},</if>
            <if test="empHomeAddress != null">emp_home_address = #{empHomeAddress},</if>
            <if test="empReference != null">emp_reference = #{empReference},</if>
            <if test="empUpdateTime != null">emp_update_time = #{empUpdateTime},</if>
            <if test="empExpireTime != null">emp_expire_time = #{empExpireTime},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="nation != null and nation != ''">nation = #{nation},</if>
            <if test="retireReminder != null and retireReminder != ''">retire_reminder = #{retireReminder},</if>
            <if test="hireLimitDate != null">hire_limit_date = #{hireLimitDate},</if>
            <if test="deptInfoTwo != null and deptInfoTwo != ''">dept_info_two = #{deptInfoTwo},</if>
            <if test="deptInfoThree != null and deptInfoThree != ''">dept_info_three = #{deptInfoThree},</if>
            <if test="empPositionCategory != null and empPositionCategory != ''">emp_position_category =
                #{empPositionCategory},
            </if>
            <if test="nativePlace != null and nativePlace != ''">native_place = #{nativePlace},</if>
            <if test="birthPlace != null and birthPlace != ''">birth_place = #{birthPlace},</if>
            <if test="domicilePlace != null and domicilePlace != ''">domicile_place = #{domicilePlace},</if>
            <if test="school != null and school != ''">school = #{school},</if>
            <if test="highestEducation != null and highestEducation != ''">highest_education = #{highestEducation},</if>
            <if test="graduateTime != null">graduate_time = #{graduateTime},</if>
            <if test="acquireTime != null">acquire_time = #{acquireTime},</if>
            <if test="attendTime != null">attend_time = #{attendTime},</if>
            <if test="refuseMonth != null">refuse_month = #{refuseMonth},</if>
            <if test="accumulativeMonth != null">accumulative_month = #{accumulativeMonth},</if>
            <if test="contractStartTime != null">contract_start_time = #{contractStartTime},</if>
            <if test="contractEndTime != null">contract_end_time = #{contractEndTime},</if>
            <if test="workPhone != null and workPhone != ''">work_phone = #{workPhone},</if>
            <if test="onJobTime != null">on_job_time = #{onJobTime},</if>
            <if test="birthDate != null">birth_date = #{birthDate},</if>
            <if test="salaryLevelMin != null and salaryLevelMin != ''">salary_level_min = #{salaryLevelMin},</if>
            <if test="salaryLevelMax != null and salaryLevelMax != ''">salary_level_max = #{salaryLevelMax},</if>
        </trim>
        where history_id = #{historyId}
    </update>
    <update id="changeEmpStatusByEmpIdsAndEmpStatus">
        update emp_history
        set emp_status = #{empStatus}
        where emp_id in
        <foreach collection="empIds" item="empId" open="(" close=")" separator=",">
            #{empId}
        </foreach>
        and history_year_moth >= date_format(#{startTime},'%Y-%m')
    </update>
    <update id="encodeEmpHistoryIdCardInfo">
        update emp_history
        set emp_idcard = SP_ENCRYPT(#{empIdcard})
        where history_id = #{historyId}
    </update>
    <update id="decodeEmpHistoryIdCardInfo">
        update emp_history
        set emp_idcard = CAST(SP_DECRYPT(#{empIdcard}) AS CHAR(128))
        where history_id = #{historyId}
    </update>

    <delete id="deleteEmpHistoryByHistoryId" parameterType="Long">
        update emp_history
        set disabled = 1
        where history_id = #{historyId}
    </delete>

    <delete id="deleteEmpHistoryByHistoryIds" parameterType="String">
        update emp_history set disabled = 1 where history_id in
        <foreach item="historyId" collection="array" open="(" separator="," close=")">
            #{historyId}
        </foreach>
    </delete>
    <delete id="removeCurrentMonthHistory">
        delete
        from emp_history
        where history_year_moth = date_format(#{now}, '%Y-%m')
    </delete>
    <delete id="removeEmpHistoryListByYearMonth">
        delete
        from emp_history
        where history_year_moth =
              #{yearMonth}
    </delete>
    <delete id="deleteEmpInfoByEmpNameAndYearMoth">
        delete
        from emp_history
        where history_year_moth =
              #{yearMonth}
          and emp_name = #{empName}
    </delete>

    <select id="selectRecentEmpHistory" parameterType="String" resultType="com.yuantu.labor.domain.EmpHistory">
        select emp_id, max(history_year_moth) as history_year_moth
        from emp_history
        where disabled = 0
        GROUP BY emp_id
        having history_year_moth &lt;= #{lastMonth}
    </select>
    <select id="findLatestHistoryYearMonth" resultType="java.lang.String">
        select max(history_year_moth)
        from emp_history
        where disabled = 0
    </select>
    <select id="selectEmpDetailHistoryInfosByYearMonth" resultType="com.yuantu.labor.domain.EmpHistory">
        <include refid="selectEmpHistoryVo"/>
        where history_year_moth =
        #{yearMonth} and disabled = 0
    </select>
    <select id="selectEmpDetailHistoryInfosBetweenYearMonth" resultType="com.yuantu.labor.domain.EmpHistory">
        <include refid="selectEmpHistoryVo"/>
        where disabled = 0 and history_year_moth between #{beforeMonth} and #{afterMonth}
    </select>
</mapper>